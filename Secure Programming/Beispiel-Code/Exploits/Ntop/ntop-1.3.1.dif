--- .ntop
+++ .ntop	2000/07/05 00:09:33
@@ -0,0 +1,5 @@
+# user		pw
+#
+#
+root		root
+ 
--- Makefile.am
+++ Makefile.am	2000/07/05 00:14:52
@@ -245,14 +245,14 @@
 
 install-data-local:
 	@cp -p ntop-cert.pem $(bindir)/ntop-cert.pem
-	@$(top_srcdir)/mkinstalldirs $(bindir)/plugins;
-	@$(top_srcdir)/mkinstalldirs $(sysconfdir)/ntop;
-	@$(top_srcdir)/mkinstalldirs $(sysconfdir)/ntop/html;
+	@$(top_srcdir)/mkinstalldirs $(libdir)/ntop/plugins;
+	@$(top_srcdir)/mkinstalldirs $(datadir)/ntop;
+	@$(top_srcdir)/mkinstalldirs $(datadir)/ntop/html;
 	@for file in $(NTOPHTML); do \
           if test -d $$file; then \
-             $(top_srcdir)/mkinstalldirs $(sysconfdir)/ntop/$$file; \
+             $(top_srcdir)/mkinstalldirs $(datadir)/ntop/$$file; \
            else \
-             cp -p $$file $(sysconfdir)/ntop/$$file; \
+             cp -p $$file $(datadir)/ntop/$$file; \
           fi; \
         done
 
--- admin.c
+++ admin.c	2000/07/05 00:09:33
@@ -66,6 +66,10 @@
     free(key_data.dptr);
   }
     
+#ifdef MULTITHREADED
+    releaseMutex(&gdbmMutex);
+#endif 
+
   if(numUsers > 0) {
     sendString("</table>\n");
   }
@@ -73,9 +77,6 @@
   sendString("<p><H4></center>[<A HREF=addUser.html>Add User</A>]&nbsp;"
 	     "[<A HREF=showURLs.html>Show URLs</A>]</H4>\n");
 
-#ifdef MULTITHREADED
-    releaseMutex(&gdbmMutex);
-#endif 
 }
 
 /* *******************************/
--- globals-core.c
+++ globals-core.c	2000/07/05 00:11:50
@@ -178,6 +178,7 @@
   "/etc/ntop",           /* Default */
   "/opt/ntop/etc/ntop",  /* Solaris */
   "/usr/local/etc/ntop", /* BSD     */
+  "/usr/lib/ntop",     /* Suse    */
   "/usr/share/ntop",     /* Suse    */
   ".",                   /* Local   */
 #endif
--- http.c
+++ http.c	2000/07/05 12:25:23
@@ -431,13 +431,17 @@
 
   /* printf("Page: '%s'\n", pageName); */
 
-  if(questionMark == NULL)
+  /* Fix below courtesy of Robert Shih <robert.shih@nomura.co.uk> */
+  if((questionMark == NULL) 
+	|| ((questionMark[0] == '?') && (!isdigit(questionMark[1]))))
     sortedColumn = 0;
   else {
     if((questionMark[0] == '?') && (strlen(questionMark) > 3)) {
-      questionMark[0] = '\0';
-      questionMark = strchr(&questionMark[1], '=');
-      sortedColumn = 1+abs(atoi(&questionMark[1]));
+      if ( strchr(&questionMark[1], '=') ) {
+        questionMark[0] = '\0';
+        questionMark = strchr(&questionMark[1], '=');
+        sortedColumn = 1+abs(atoi(&questionMark[1]));
+      }
     } else {
       sortedColumn = abs(atoi(&questionMark[1]));
 
--- ntopd
+++ ntopd	2000/07/05 00:09:33
@@ -0,0 +1,65 @@
+#! /bin/sh
+# Copyright (c) 1995-1998 S.u.S.E. GmbH Fuerth, Germany.
+#
+# Author: Remo Behn <ray@suse.de>
+#
+# /sbin/init.d/ntop
+#
+# and symbolic its link
+#
+# /sbin/rc2.d/S20ntopd
+# /sbin/rc2.d/K20ntopd
+# /sbin/rc3.d/S20ntopd
+# /sbin/rc3.d/K20ntopd
+#
+
+. /etc/rc.status
+. /etc/rc.config
+
+# Determine the base and follow a runlevel link name.
+base=${0##*/}
+link=${base#*[SK][0-9][0-9]}
+
+# Force execution if not called by a runlevel directory.
+test $link = $base && START_NTOPD=yes
+test "$START_NTOPD" = yes || exit 0
+
+# The echo return value for success (defined in /etc/rc.config).
+return=$rc_done
+case "$1" in
+    start)
+	echo -n "Starting service ntop"
+	## Start daemon with startproc(8). If this fails
+	## the echo return value is set appropriate.
+
+	startproc -q /usr/bin/ntop -i $NTOPD_IFACE -w $NTOPD_PORT -P /var/lib/ntop
+
+	rc_status -v
+	;;
+    stop)
+	echo -n "Shutting down service ntop"
+	## Stop daemon with killproc(8) and if this fails
+	## set echo the echo return value.
+
+	killproc -TERM /usr/bin/ntop
+
+	rc_status -v
+	;;
+    restart|reload)
+	$0 stop && $0 start
+	rc_status
+	;;
+    status)
+	echo -n "Checking for service ntop: "
+	## Check status with checkproc(8), if process is running
+	## checkproc will return with exit status 0.
+
+	checkproc /usr/bin/ntop && echo OK || echo No process
+	;;
+    *)
+	echo "Usage: $0 {start|stop|restart|reload|status}"
+	exit 1
+	;;
+esac
+rc_exit
+
--- plugins/Makefile.am
+++ plugins/Makefile.am	2000/07/05 00:12:34
@@ -33,7 +33,7 @@
 # 
 # Where to install the plugin 
 # 
-plugindir = $(bindir)/plugins
+plugindir = $(libdir)/ntop/plugins
 
 INCLUDES = -I.. @INCS@
 
@@ -97,4 +97,4 @@
 # remove installed libraries
 	@for file in $(lib_LTLIBRARIES); do \
              rm -f $(DESTDIR)$(libdir)/$$file; \
-         done
\ No newline at end of file
+         done
--- rc.config.ntopd
+++ rc.config.ntopd	2000/07/05 00:09:33
@@ -0,0 +1,25 @@
+
+#
+# start the ntopd (yes|no)
+#
+START_NTOPD="no"
+
+#
+# Specifies the network interface used by ntop
+#
+NTOPD_IFACE="eth0"
+
+#
+# Supposing to start  ntop  at  the port  3000,
+# the  URL  to  access  is http://hostname:3000/
+#
+# The file /root/.ntop  specifies  the
+# HTTP  user/password  of those people who are allowed to
+# access ntop. If the /root/.ntop file is missing no security
+# will be used hence everyone can access traffic informa-
+# tion. Please note that an HTTP server is NOT needed  in
+# order to use the program in interactive mode.
+#
+NTOPD_PORT="3000"
+
+
