#define _GNU_SOURCE

#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>

#include "errormsg.h"

int main(void)
{
	int		i, max_fdesc;
	struct stat	stat_buf;


	if((max_fdesc = sysconf(_SC_OPEN_MAX)) < 0)
        	max_fdesc = 1024;

	fprintf(stderr, "BREAK: Current working direc.: %s\n",  get_current_dir_name());

	for(i = 0; i < max_fdesc; i++)
	{
		putchar('.');

		if(fstat(i, &stat_buf) < 0)
		{
			//err_mesg(WARN_SYS, "BREAK: Can't fstat");
			continue;
		}

		if(S_ISDIR(stat_buf.st_mode))
		{
			printf("BREAK: Found dir. desc.!");
			if(fchdir(i) < 0)
			{
				err_mesg(WARN_SYS, "BREAK: Can't fchdir");
				continue;
			}

			fprintf(stderr, "BREAK: Current working direc.: %s\n",  get_current_dir_name());
		}
	}
}
